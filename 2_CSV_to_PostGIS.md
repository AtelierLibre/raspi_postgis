# 2. CSV to PostGIS

To list the existing databases `\l` or `\list` and to create a new database:

`CREATE DATABASE test_gis;`

Then connect to it using:

`\c test_gis;`

Create the PostGIS extension within it:

`CREATE EXTENSION IF NOT EXISTS postgis;`

## Create a table to hold the raw WKT

### Shop points

```
DROP TABLE IF EXISTS shop_points_raw CASCADE;
CREATE TABLE shop_points_raw (
    wkt text
);
```

Copy the shop points data out of the .csv file into the table:

`\copy shop_points_raw FROM 'barnsbury_shop_points_27700.csv' WITH (FORMAT csv, HEADER true)`

### Street segments

```
DROP TABLE IF EXISTS street_segments_raw CASCADE;
CREATE TABLE street_segments_raw (
    wkt text
);
```

Copy the street segments data out of the .csv file into the table:

`\copy street_segments_raw FROM 'barnsbury_street_segments_27700.csv' WITH (FORMAT csv, HEADER true)`

Looking at the table we can see that it just contains the text description of the geometry:

`SELECT * FROM street_segments_raw`

## Convert the raw text table to geometry

First of all define a new table with an incrementing id and a geometry column with the appropriate SRID:

```
DROP TABLE IF EXISTS street_segments CASCADE;
CREATE TABLE street_segments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    geom geometry(LineString, 27700)
);
```

Then convert the WKT to geometries, and set the SRID of each one:

```
INSERT INTO street_segments (geom)
SELECT ST_SetSRID(ST_GeomFromText(wkt), 27700)
FROM street_segments_raw;
```

Finally, check the table:

`SELECT * FROM street_segments`

Check the length:

```
SELECT id, ST_Length(geom) AS length_units
FROM street_segments;
```